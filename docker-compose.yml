services:
  backend:
    build:
      context: ./backend
    container_name: estateassess_backend
    ports:
      - "${BACKEND_PORT:-8201}:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - GEMINI_API_KEY=${VITE_GEMINI_API_KEY}
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./backend:/app

  frontend:
    build:
      context: ./frontend
      args:
        - VITE_API_BASE_URL=${VITE_API_BASE_URL:-http://localhost:8201/api/v1}
    container_name: estateassess_frontend
    ports:
      - "${FRONTEND_PORT:-8200}:80"
    depends_on:
      - backend
    volumes:
      - ./frontend:/app
      - /app/node_modules

  postgres:
    extends:
      file: devinfra/docker-compose.yml
      service: postgres
    ports:
      - "${DB_PORT:-8202}:5432"

  redis:
    extends:
      file: devinfra/docker-compose.yml
      service: redis
    ports:
      - "${REDIS_PORT:-8203}:6379"

volumes:
  postgres_data:
  redis_data:
